/*CREATE DATABASE PURCHASE_PRODUCT_DB;*/

/*USE PURCHASE_PRODUCT_DB;*/

CREATE TABLE IF NOT EXISTS `company` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `company_name` VARCHAR(255) NOT NULL,
  `company_ref` VARCHAR(255) NOT NULL,
  `description` VARCHAR(255) NULL DEFAULT NULL,
  `register_date` DATETIME NOT NULL,
  PRIMARY KEY (`id`),
  CONSTRAINT`UK_company_company_name` UNIQUE (`company_name`));


  CREATE TABLE IF NOT EXISTS `product` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `creation_date` DATETIME NOT NULL,
  `description` VARCHAR(100) NULL DEFAULT NULL,
  `name` VARCHAR(100) NOT NULL,
  `price` DECIMAL(19,2) NOT NULL,
  `product_ref` VARCHAR(250) NOT NULL,
  `promotion` BIT(1) NOT NULL,
  `graduation` VARCHAR(100) NOT NULL,
  `nationality` VARCHAR(100) NOT NULL,
  `beer_type` VARCHAR(100) NOT NULL,
  `company_id` NULL DEFAULT NULL,
   PRIMARY KEY (`id`),
   CONSTRAINT `UK_product_name` UNIQUE (`name`),
   CONSTRAINT `UK_product_product_ref` UNIQUE (`product_ref`),
   INDEX `FK_product_company_id` (`company_id` ASC),
  CONSTRAINT `FK_product_company_id`
    FOREIGN KEY (`company_id`)
    REFERENCES `company` (`id`));

CREATE TABLE IF NOT EXISTS `user` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `active` BIT(1) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `first_name` VARCHAR(255) NULL DEFAULT NULL,
  `last_name` VARCHAR(255) NOT NULL,
  `modification_date` DATETIME NULL DEFAULT NULL,
  `password` VARCHAR(255) NOT NULL,
  `register_date` DATETIME NOT NULL,
  `username` VARCHAR(255) NOT NULL,
  PRIMARY KEY (`id`),
    CONSTRAINT `UK_user_email` UNIQUE (`email`),
    CONSTRAINT `UK_user_username` UNIQUE (`username`));

  CREATE TABLE IF NOT EXISTS `purchase` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `created` DATETIME NOT NULL,
  `purchase_date` DATETIME NULL DEFAULT NULL,
  `purchase_details` VARCHAR(500) NULL DEFAULT NULL,
  `purchase_ref` VARCHAR(45) NOT NULL,
  `active` BIT(1) NOT NULL,
  `updated` DATETIME NULL DEFAULT NULL,
  `user_id` BIGINT NOT NULL,
  PRIMARY KEY (`id`),
  CONSTRAINT `FK_purchase_user_id`
    FOREIGN KEY (`user_id`)
    REFERENCES `user` (`id`),
  CONSTRAINT `UK_purchase_purchase_ref` UNIQUE (`purchase_ref`));

CREATE TABLE IF NOT EXISTS `user_company` (
  `user_id` BIGINT NOT NULL,
  `company_id` BIGINT NOT NULL,
   INDEX `FK_user_company_company_id` (`company_id` ASC),
  INDEX `FK_user_company_user_id` (`user_id` ASC),
  CONSTRAINT `FK_user_company_company_id`
    FOREIGN KEY (`company_id`)
    REFERENCES `company` (`id`),
  CONSTRAINT `FK_user_company_user_id`
    FOREIGN KEY (`user_id`)
    REFERENCES `user` (`id`),
    CONSTRAINT `UK_user_company_company_id_user_id` UNIQUE (`user_id`, `company_id`)
    );


CREATE TABLE IF NOT EXISTS `product_purchase` (
  `product_id` BIGINT NOT NULL,
  `purchase_id` BIGINT NOT NULL,
  `product_purchase_comment` VARCHAR(750) NULL DEFAULT NULL,
  `product_purchase_date` DATETIME NOT NULL,
    INDEX `IN_product_purchase_product_id` (`product_id` ASC),
	INDEX `IN_product_purchase_purchase_id` (`purchase_id` ASC),

	CONSTRAINT `FK_product_purchase_prod_id`
      FOREIGN KEY (`product_id`)
      REFERENCES `product` (`id`),
	CONSTRAINT `FK_product_purchase_pur_id`
      FOREIGN KEY (`purchase_id`)
      REFERENCES `purchase` (`id`),
    CONSTRAINT `UK_product_purchase_product_id_purchase_id` UNIQUE (`product_id`, `purchase_id`)
    )
    ENGINE = InnoDB
	DEFAULT CHARACTER SET = utf8;

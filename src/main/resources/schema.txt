CREATE DATABASE PRODUCT_PURCHASE_DB;

USE PRODUCT_PURCHASE_DB;

ALTER DATABASE `PRODUCT_PURCHASE_DB` DEFAULT CHARACTER SET utf8 COLLATE utf8_bin;

CREATE TABLE IF NOT EXISTS `COMPANY` (
  `ID` BIGINT NOT NULL AUTO_INCREMENT,
  `COMPANY_NAME` VARCHAR(255) NOT NULL,
  `COMPANY_REF` VARCHAR(255) NOT NULL,
  `DESCRIPTION` VARCHAR(255) NULL DEFAULT NULL,
  `REGISTER_DATE` DATETIME NOT NULL,
  PRIMARY KEY (`ID`),
  CONSTRAINT`UK_COMPANY_COMPANY_NAME` UNIQUE (`COMPANY_NAME`));


  CREATE TABLE IF NOT EXISTS `PRODUCT` (
  `ID` BIGINT NOT NULL AUTO_INCREMENT,
  `CREATION_DATE` DATETIME NOT NULL,
  `DESCRIPTION` VARCHAR(100) NULL DEFAULT NULL,
  `NAME` VARCHAR(100) NOT NULL,
  `PRICE` DECIMAL(19,2) NOT NULL,
  `PRODUCT_REF` VARCHAR(250) NOT NULL,
  `PROMOTION` BIT(1) NOT NULL,
  `GRADUATION` VARCHAR(100) NOT NULL,
  `NATIONALITY` VARCHAR(100) NOT NULL,
  `BEER_TYPE` VARCHAR(100) NOT NULL,
  `COMPANY_ID` BIGINT NULL DEFAULT NULL,
   PRIMARY KEY (`ID`),
   CONSTRAINT `UK_PRODUCT_NAME` UNIQUE (`NAME`),
   CONSTRAINT `UK_PRODUCT_PRODUCT_REF` UNIQUE (`PRODUCT_REF`),
   INDEX `FK_PRODUCT_COMPANY_ID` (`COMPANY_ID` ASC),
  CONSTRAINT `FK_PRODUCT_COMPANY_ID`
    FOREIGN KEY (`COMPANY_ID`)
    REFERENCES `COMPANY` (`ID`));

CREATE TABLE IF NOT EXISTS `USER` (
  `ID` BIGINT NOT NULL AUTO_INCREMENT,
  `ACTIVE` BIT(1) NOT NULL,
  `EMAIL` VARCHAR(255) NOT NULL,
  `FIRST_NAME` VARCHAR(255) NULL DEFAULT NULL,
  `LAST_NAME` VARCHAR(255) NOT NULL,
  `MODIFICATION_DATE` DATETIME NULL DEFAULT NULL,
  `PASSWORD` VARCHAR(255) NOT NULL,
  `REGISTER_DATE` DATETIME NOT NULL,
  `USERNAME` VARCHAR(255) NOT NULL,
  PRIMARY KEY (`ID`),
    CONSTRAINT `UK_USER_EMAIL` UNIQUE (`EMAIL`),
    CONSTRAINT `UK_USER_USERNAME` UNIQUE (`USERNAME`));

  CREATE TABLE IF NOT EXISTS `PURCHASE` (
  `ID` BIGINT NOT NULL AUTO_INCREMENT,
  `CREATED` DATETIME NOT NULL,
  `PURCHASE_DATE` DATETIME NULL DEFAULT NULL,
  `PURCHASE_DETAIL` VARCHAR(500) NULL DEFAULT NULL,
  `PURCHASE_REF` VARCHAR(45) NOT NULL,
  `ACTIVE` BIT(1) NOT NULL,
  `UPDATED` DATETIME NULL DEFAULT NULL,
  `USER_ID` BIGINT NOT NULL,
  PRIMARY KEY (`ID`),
  CONSTRAINT `FK_PURCHASE_USER_ID`
    FOREIGN KEY (`USER_ID`)
    REFERENCES `USER` (`ID`),
  CONSTRAINT `UK_PURCHASE_PURCHASE_REF` UNIQUE (`PURCHASE_REF`));

CREATE TABLE IF NOT EXISTS `USER_COMPANY` (
  `USER_ID` BIGINT NOT NULL,
  `COMPANY_ID` BIGINT NOT NULL,
   INDEX `FK_USER_COMPANY_COMPANY_ID` (`COMPANY_ID` ASC),
  INDEX `FK_USER_COMPANY_USER_ID` (`USER_ID` ASC),
  CONSTRAINT `FK_USER_COMPANY_COMPANY_ID`
    FOREIGN KEY (`COMPANY_ID`)
    REFERENCES `COMPANY` (`ID`),
  CONSTRAINT `FK_USER_COMPANY_USER_ID`
    FOREIGN KEY (`USER_ID`)
    REFERENCES `USER` (`ID`),
    CONSTRAINT `UK_USER_COMPANY_COMPANY_USER_ID` UNIQUE (`USER_ID`, `COMPANY_ID`)
    );


CREATE TABLE IF NOT EXISTS `PRODUCT_PURCHASE` (
  `PRODUCT_ID` BIGINT NOT NULL,
  `PURCHASE_ID` BIGINT NOT NULL,
  `PRODUCT_PURCHASE_COMMENT` VARCHAR(750) NULL DEFAULT NULL,
  `PRODUCT_PURCHASE_DATE` DATETIME NOT NULL,
    INDEX `IN_PRODUCT_PURCHASE_PRODUCT_ID` (`PRODUCT_ID` ASC),
	INDEX `IN_PRODUCT_PURCHASE_PURCHASE_ID` (`PURCHASE_ID` ASC),

	CONSTRAINT `FK_PRODUCT_PURCHASE_PROD_ID`
      FOREIGN KEY (`PRODUCT_ID`)
      REFERENCES `PRODUCT` (`ID`),
	CONSTRAINT `FK_PRODUCT_PURCHASE_PUR_ID`
      FOREIGN KEY (`PURCHASE_ID`)
      REFERENCES `PURCHASE` (`ID`),
    CONSTRAINT `UK_PRODUCT_PURCHASE_PRO_PUR_ID` UNIQUE (`PRODUCT_ID`, `PURCHASE_ID`)
    )
    ENGINE = InnoDB
	DEFAULT CHARACTER SET = utf8;
